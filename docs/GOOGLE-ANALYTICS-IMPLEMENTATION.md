# üéØ **Implementa√ß√£o do Google Analytics (gtag) no Vision LMS**

## üìã **Vis√£o Geral**

Implementa√ß√£o completa do Google Analytics para tracking de usu√°rios e coleta de dados de comportamento no sistema LMS.

## üöÄ **Funcionalidades Implementadas**

### **1. Tracking Autom√°tico de P√°ginas**
- ‚úÖ **Pageviews autom√°ticos**: Cada navega√ß√£o √© registrada automaticamente
- ‚úÖ **URLs din√¢micas**: Suporte a rotas din√¢micas (`/trilha/[courseId]`, `/trilha/[courseId]/[videoId]`)
- ‚úÖ **Par√¢metros de busca**: Tracking de filtros e par√¢metros de URL

### **2. Eventos Customizados para LMS**
- ‚úÖ **Visualiza√ß√£o de cursos**: Quando usu√°rio clica em um curso
- ‚úÖ **Visualiza√ß√£o de v√≠deos**: Quando usu√°rio acessa uma aula
- ‚úÖ **Progresso de v√≠deos**: Tracking de tempo assistido
- ‚úÖ **Conclus√£o de v√≠deos**: Quando usu√°rio completa uma aula
- ‚úÖ **Conclus√£o de cursos**: Quando usu√°rio completa todo o curso
- ‚úÖ **Login/Signup**: Tracking de autentica√ß√£o
- ‚úÖ **Busca e filtros**: Uso de funcionalidades de busca

### **3. M√©tricas de Engajamento**
- ‚úÖ **Tempo de visualiza√ß√£o**: Dura√ß√£o de cada sess√£o de v√≠deo
- ‚úÖ **Taxa de conclus√£o**: Percentual de v√≠deos/cursos completados
- ‚úÖ **Padr√µes de navega√ß√£o**: Como usu√°rios navegam pelo sistema
- ‚úÖ **Uso de filtros**: Quais filtros s√£o mais utilizados

## üîß **Arquitetura T√©cnica**

### **1. Estrutura de Arquivos**
```
lib/
‚îú‚îÄ‚îÄ gtag.ts                    # Configura√ß√£o e fun√ß√µes do GA
hooks/
‚îú‚îÄ‚îÄ use-analytics.ts           # Hook personalizado para tracking
components/
‚îú‚îÄ‚îÄ GoogleAnalytics.tsx        # Componente de inicializa√ß√£o
app/
‚îú‚îÄ‚îÄ layout.tsx                 # Integra√ß√£o no layout principal
```

### **2. Componentes Principais**

#### **`lib/gtag.ts` - Configura√ß√£o Central**
```typescript
// ID do Google Analytics
export const GA_TRACKING_ID = 'G-4R2NGMMBW3'

// Fun√ß√µes de tracking
export const pageview = (url: string) => { /* ... */ }
export const event = ({ action, category, label, value }) => { /* ... */ }

// Eventos espec√≠ficos para LMS
export const trackCourseView = (courseId: string, courseTitle: string) => { /* ... */ }
export const trackVideoView = (videoId: string, videoTitle: string, courseId: string) => { /* ... */ }
export const trackVideoProgress = (videoId: string, progressSeconds: number, courseId: string) => { /* ... */ }
export const trackVideoCompletion = (videoId: string, courseId: string, totalDuration: number) => { /* ... */ }
export const trackCourseCompletion = (courseId: string, courseTitle: string) => { /* ... */ }
export const trackUserLogin = (userId: string) => { /* ... */ }
export const trackUserSignup = (userId: string) => { /* ... */ }
export const trackSearch = (searchTerm: string, resultsCount: number) => { /* ... */ }
export const trackFilter = (filterType: string, filterValue: string) => { /* ... */ }
```

#### **`components/GoogleAnalytics.tsx` - Inicializa√ß√£o**
```typescript
'use client'

import Script from 'next/script'
import { usePathname, useSearchParams } from 'next/navigation'
import { useEffect } from 'react'
import { GA_TRACKING_ID, pageview } from '@/lib/gtag'

export default function GoogleAnalytics() {
  const pathname = usePathname()
  const searchParams = useSearchParams()

  useEffect(() => {
    const url = pathname + searchParams.toString()
    pageview(url)
  }, [pathname, searchParams])

  return (
    <>
      <Script
        strategy="afterInteractive"
        src={`https://www.googletagmanager.com/gtag/js?id=${GA_TRACKING_ID}`}
      />
      <Script
        id="gtag-init"
        strategy="afterInteractive"
        dangerouslySetInnerHTML={{
          __html: `
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '${GA_TRACKING_ID}', {
              page_location: window.location.href,
            });
          `,
        }}
      />
    </>
  )
}
```

#### **`hooks/use-analytics.ts` - Hook Personalizado**
```typescript
export const useAnalytics = () => {
  // Evento customizado gen√©rico
  const trackEvent = useCallback((action: string, category: string, label?: string, value?: number) => {
    event({ action, category, label, value })
  }, [])

  // Eventos espec√≠ficos para LMS
  const trackCourse = useCallback((courseId: string, courseTitle: string) => {
    trackCourseView(courseId, courseTitle)
  }, [])

  const trackVideo = useCallback((videoId: string, videoTitle: string, courseId: string) => {
    trackVideoView(videoId, videoTitle, courseId)
  }, [])

  const trackProgress = useCallback((videoId: string, progressSeconds: number, courseId: string) => {
    trackVideoProgress(videoId, progressSeconds, courseId)
  }, [])

  const trackVideoComplete = useCallback((videoId: string, courseId: string, totalDuration: number) => {
    trackVideoCompletion(videoId, courseId, totalDuration)
  }, [])

  const trackCourseComplete = useCallback((courseId: string, courseTitle: string) => {
    trackCourseCompletion(courseId, courseTitle)
  }, [])

  const trackLogin = useCallback((userId: string) => {
    trackUserLogin(userId)
  }, [])

  const trackSignup = useCallback((userId: string) => {
    trackUserSignup(userId)
  }, [])

  const trackSearchQuery = useCallback((searchTerm: string, resultsCount: number) => {
    trackSearch(searchTerm, resultsCount)
  }, [])

  const trackFilterUsage = useCallback((filterType: string, filterValue: string) => {
    trackFilter(filterType, filterValue)
  }, [])

  return {
    trackEvent,
    trackCourse,
    trackVideo,
    trackProgress,
    trackVideoComplete,
    trackCourseComplete,
    trackLogin,
    trackSignup,
    trackSearchQuery,
    trackFilterUsage,
  }
}
```

## üìä **Eventos Implementados**

### **1. Eventos de Curso**
| Evento | Categoria | Label | Valor | Descri√ß√£o |
|--------|-----------|-------|-------|-----------|
| `view_course` | `course` | Nome do curso | - | Usu√°rio visualizou um curso |
| `course_completion` | `course` | Nome do curso | - | Usu√°rio completou um curso |

### **2. Eventos de V√≠deo**
| Evento | Categoria | Label | Valor | Descri√ß√£o |
|--------|-----------|-------|-------|-----------|
| `view_video` | `video` | `courseId:videoTitle` | - | Usu√°rio visualizou um v√≠deo |
| `video_progress` | `video` | `courseId` | Segundos | Progresso em segundos |
| `video_completion` | `video` | `courseId` | Dura√ß√£o total | V√≠deo completado |

### **3. Eventos de Usu√°rio**
| Evento | Categoria | Label | Valor | Descri√ß√£o |
|--------|-----------|-------|-------|-----------|
| `user_login` | `user` | `userId` | - | Usu√°rio fez login |
| `user_signup` | `user` | `userId` | - | Usu√°rio se registrou |

### **4. Eventos de Engajamento**
| Evento | Categoria | Label | Valor | Descri√ß√£o |
|--------|-----------|-------|-------|-----------|
| `search` | `engagement` | Termo buscado | Resultados | Busca realizada |
| `filter` | `engagement` | `tipo:valor` | - | Filtro aplicado |

## üîÑ **Integra√ß√£o nos Componentes**

### **1. TrainingCard - Tracking de Visualiza√ß√£o**
```typescript
export function TrainingCard({ id, titulo, ... }: TrainingCardProps) {
  const { trackCourse } = useAnalytics()

  const handleCourseView = () => {
    trackCourse(id, titulo)
  }

  return (
    <Link href={href} className="block" onClick={handleCourseView}>
      {/* Conte√∫do do card */}
    </Link>
  )
}
```

### **2. DashboardFilters - Tracking de Filtros**
```typescript
export function DashboardFilters({ ... }: DashboardFiltersProps) {
  const { trackFilterUsage } = useAnalytics()

  const handleFilterChange = (key: keyof DashboardFiltersType, value: string) => {
    onFilterChange(key, value)
    
    if (key === 'categoria' && value) {
      trackFilterUsage('categoria', value)
    } else if (key === 'status' && value) {
      trackFilterUsage('status', value)
    }
  }
}
```

### **3. Dashboard - Tracking de Busca**
```typescript
export default function DashboardClient({ ... }: DashboardClientProps) {
  const { trackSearchQuery } = useAnalytics()

  const handleFilterChange = (key: keyof typeof filters, value: string) => {
    atualizarFiltro(key, value)
    
    if (key === 'busca' && value.trim()) {
      const resultsCount = treinamentosFiltrados.length
      trackSearchQuery(value.trim(), resultsCount)
    }
  }
}
```

## üéØ **Configura√ß√£o do Google Analytics**

### **1. Script de Inicializa√ß√£o**
```html
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4R2NGMMBW3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-4R2NGMMBW3');
</script>
```

### **2. ID de Rastreamento**
- **ID**: `G-4R2NGMMBW3`
- **Propriedade**: Vision LMS
- **Tipo**: GA4 (Google Analytics 4)

## üìà **M√©tricas Dispon√≠veis**

### **1. Vis√£o Geral**
- ‚úÖ **Usu√°rios ativos**: Quantos usu√°rios √∫nicos acessaram
- ‚úÖ **Sess√µes**: N√∫mero total de sess√µes
- ‚úÖ **Pageviews**: Visualiza√ß√µes de p√°ginas
- ‚úÖ **Taxa de rejei√ß√£o**: Percentual de sess√µes com uma p√°gina

### **2. Comportamento do Usu√°rio**
- ‚úÖ **P√°ginas mais visitadas**: Quais cursos/v√≠deos s√£o mais populares
- ‚úÖ **Tempo na p√°gina**: Engajamento com o conte√∫do
- ‚úÖ **Fluxo de usu√°rio**: Como usu√°rios navegam pelo sistema
- ‚úÖ **Eventos personalizados**: M√©tricas espec√≠ficas do LMS

### **3. Performance de Cursos**
- ‚úÖ **Taxa de conclus√£o**: Percentual de usu√°rios que completam cursos
- ‚úÖ **Tempo m√©dio de conclus√£o**: Dura√ß√£o m√©dia para completar um curso
- ‚úÖ **Drop-off points**: Onde usu√°rios abandonam cursos
- ‚úÖ **Re-engagement**: Usu√°rios que retornam para completar cursos

## üöÄ **Como Usar**

### **1. Tracking Autom√°tico**
```typescript
// ‚úÖ Tracking autom√°tico de p√°ginas
// N√£o √© necess√°rio fazer nada - funciona automaticamente
```

### **2. Tracking de Eventos Customizados**
```typescript
import { useAnalytics } from '@/hooks/use-analytics'

export function MeuComponente() {
  const { trackCourse, trackVideo } = useAnalytics()

  const handleCourseClick = () => {
    trackCourse('course-123', 'Nome do Curso')
  }

  const handleVideoClick = () => {
    trackVideo('video-456', 'Nome do V√≠deo', 'course-123')
  }
}
```

### **3. Tracking de Progresso**
```typescript
const { trackProgress } = useAnalytics()

// Em um player de v√≠deo
const handleTimeUpdate = (currentTime: number) => {
  trackProgress('video-456', Math.floor(currentTime), 'course-123')
}
```

### **4. Tracking de Conclus√£o**
```typescript
const { trackVideoComplete } = useAnalytics()

const handleVideoEnd = () => {
  trackVideoComplete('video-456', 'course-123', videoDuration)
}
```

## üîç **Debugging e Testes**

### **1. Console do Navegador**
```javascript
// Verificar se gtag est√° funcionando
console.log(window.gtag)
console.log(window.dataLayer)

// Testar evento manualmente
gtag('event', 'test_event', {
  event_category: 'test',
  event_label: 'manual_test'
})
```

### **2. Google Analytics Debugger**
- Instalar extens√£o "Google Analytics Debugger" no Chrome
- Ver eventos em tempo real no console
- Validar dados enviados para o GA

### **3. Real-time Reports**
- Acessar Google Analytics
- Ir para "Relat√≥rios em tempo real"
- Ver eventos sendo registrados em tempo real

## üì± **Responsividade e Performance**

### **1. Estrat√©gia de Carregamento**
- ‚úÖ **`afterInteractive`**: Scripts carregam ap√≥s a p√°gina estar interativa
- ‚úÖ **Lazy loading**: N√£o bloqueia o carregamento inicial
- ‚úÖ **Suspense boundary**: Evita erros de hidrata√ß√£o

### **2. Otimiza√ß√µes**
- ‚úÖ **Debounce**: Evita m√∫ltiplos eventos de progresso
- ‚úÖ **Callback memoization**: Fun√ß√µes otimizadas com useCallback
- ‚úÖ **Type safety**: TypeScript para evitar erros

## üîí **Privacidade e Compliance**

### **1. GDPR Compliance**
- ‚úÖ **Consentimento**: Usu√°rio deve aceitar cookies
- ‚úÖ **Anonimiza√ß√£o**: IDs de usu√°rio n√£o s√£o expostos diretamente
- ‚úÖ **Controle**: Usu√°rio pode desabilitar tracking

### **2. Dados Coletados**
- ‚úÖ **Comportamento**: Como usu√°rio interage com o sistema
- ‚úÖ **Performance**: M√©tricas de engajamento e conclus√£o
- ‚úÖ **N√£o pessoais**: N√£o coleta informa√ß√µes pessoais sens√≠veis

## üöÄ **Pr√≥ximos Passos**

### **1. Implementa√ß√µes Futuras**
- üîÑ **A/B Testing**: Testar diferentes layouts e funcionalidades
- üîÑ **Funnels**: An√°lise de convers√£o de usu√°rios
- üîÑ **Cohort Analysis**: An√°lise de reten√ß√£o por per√≠odo
- üîÑ **Heatmaps**: Visualiza√ß√£o de cliques e scroll

### **2. Integra√ß√µes**
- üîÑ **Google Ads**: Remarketing baseado em comportamento
- üîÑ **Google Optimize**: Otimiza√ß√£o autom√°tica de convers√£o
- üîÑ **Data Studio**: Dashboards personalizados
- üîÑ **BigQuery**: An√°lise avan√ßada de dados

## üìö **Recursos e Documenta√ß√£o**

### **1. Links √öteis**
- [Google Analytics 4 Documentation](https://developers.google.com/analytics/devguides/collection/ga4)
- [gtag.js Reference](https://developers.google.com/tag-platform/gtagjs/reference)
- [Event Measurement](https://developers.google.com/analytics/devguides/collection/ga4/events)

### **2. Exemplos de Implementa√ß√£o**
- [E-commerce Tracking](https://developers.google.com/analytics/devguides/collection/ga4/ecommerce)
- [Enhanced E-commerce](https://developers.google.com/analytics/devguides/collection/ga4/enhanced-ecommerce)
- [Custom Dimensions](https://developers.google.com/analytics/devguides/collection/ga4/custom-dimensions)

## ‚úÖ **Status da Implementa√ß√£o**

- ‚úÖ **Google Analytics configurado**
- ‚úÖ **Tracking autom√°tico de p√°ginas**
- ‚úÖ **Eventos customizados para LMS**
- ‚úÖ **Hook personalizado para uso f√°cil**
- ‚úÖ **Integra√ß√£o em componentes principais**
- ‚úÖ **Build funcionando sem erros**
- ‚úÖ **Documenta√ß√£o completa**

**Google Analytics implementado com sucesso no Vision LMS!** üéâ‚ú®
